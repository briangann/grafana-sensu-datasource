{"version":3,"sources":["../src/datasource.js"],"names":["angular","_","dateMath","kbn","convertClientsToJSON","convertClientHistoryToDataPoints","convertClientsToDataPoints","convertClientSummaryMetricsToJSON","getClientsURIs","convertEventsToJSON","convertEventsToDataPoints","convertEventsToEventMetrics","convertEventsToEventMetricsJSON","getEventsURIs","getAggregateURIs","convertAggregatesToDataPoints","convertAggregatesToJSON","getResultURIs","convertResultsToTable","convertResultsToDataPoints","convertResultsToJSON","getClientHistoryURIs","getClientHealthURIs","convertClientHealthToJSON","convertClientHealthMetricsToJSON","SensuDatasource","instanceSettings","$q","backendSrv","templateSrv","uiSegmentSrv","type","url","name","basicAuth","withCredentials","q","options","isClientTags","isClientTagValue","aQuery","tagToValue","replaceWithText","undefined","test","split","startsWith","_this","datasourceRequest","data","method","headers","then","response","generateClientQueryTags","getClientQueryTagValue","mapToClientNameAndVersion","clientQueryTags","allTags","excludedTags","i","length","keys","Object","j","keyName","indexOf","tagValue","fullKeyName","push","sort","text","expandable","tag","tagSplit","tagToMatch","tagValueToMatch","allTagValues","z","result","map","d","x","e","console","log","dimensions","values","dimensionType","aDimension","value","getVariableName","templateVar","replace","slice","templateVars","apply","filters","aFilter","filterType","aFieldName","filterFieldName","aFieldValue","filterFieldValue","templatedValue","filterFieldValueReplaced","target","URIs","dimensionURI","clientNames","checkNames","aggregateNames","getClientNames","getCheckNames","getAggregateNames","replaceFilterValues","alias","aliasReplaced","sourceType","responses","buckets","refId","hasOwnProperty","aTarget","rawTarget","filterData","aRawTarget","allResults","getBuckets","bucketKeys","aKey","processConversions","setRawTargets","processFilters","client","checkName","dimension","mapToTextValue","filter","filterURI","queries","singleTarget","targets","forEach","interval","interval_to_ms","minimumInterval","secondsToHms","deferred","defer","resolve","promise","allQueries","all","first","multipleDataQueries","results","uriType","params","httpOptions","anError","status","Error","reject","error","message","parseQueryResult","pendingQueries","dataCalls","uriList","getQueryURIByType","singleDataQuery","multiDone","errors","updates","update","title"],"mappings":";;;;;;;;;;;;;;;AAAOA,a;;AACAC,O;;AACAC,c;;AACAC,S;;AAELC,0B,qBAAAA,oB;AACAC,sC,qBAAAA,gC;AACAC,gC,qBAAAA,0B;AACAC,uC,qBAAAA,iC;AACAC,oB,qBAAAA,c;;AAGAC,yB,oBAAAA,mB;AACAC,+B,oBAAAA,yB;AACAC,iC,oBAAAA,2B;AACAC,qC,oBAAAA,+B;AACAC,mB,oBAAAA,a;;AAGAC,sB,wBAAAA,gB;AACAC,mC,wBAAAA,6B;AACAC,6B,wBAAAA,uB;;AAGAC,mB,qBAAAA,a;AACAC,2B,qBAAAA,qB;AACAC,gC,qBAAAA,0B;AACAC,0B,qBAAAA,oB;;AAGAC,0B,4BAAAA,oB;;AAGAC,yB,4BAAAA,mB;AACAC,+B,4BAAAA,yB;AACAC,sC,4BAAAA,gC;;;;;;;;;;;;;;;;;;;;;iCAGWC,e;AAEX,iCAAYC,gBAAZ,EAA8BC,EAA9B,EAAkCC,UAAlC,EAA8CC,WAA9C,EAA2DC,YAA3D,EAAyE;AAAA;;AACvE,eAAKC,IAAL,GAAYL,iBAAiBK,IAA7B;AACA,eAAKC,GAAL,GAAWN,iBAAiBM,GAA5B;AACA,eAAKC,IAAL,GAAYP,iBAAiBO,IAA7B;AACA,eAAKC,SAAL,GAAiBR,iBAAiBQ,SAAlC;AACA,eAAKC,eAAL,GAAuBT,iBAAiBS,eAAxC;AACA,eAAKC,CAAL,GAAST,EAAT;AACA,eAAKC,UAAL,GAAkBA,UAAlB;AACA,eAAKC,WAAL,GAAmBA,WAAnB;AACA,eAAKC,YAAL,GAAoBA,YAApB;AACA;AACD;;AAED;AACA;AACA;;AAEA;;;;;;;;;0CAKgBO,O,EAAS;AACvB;AACA,gBAAIC,eAAe,KAAnB;AACA,gBAAIC,mBAAmB,KAAvB;AACA,gBAAIC,SAAS,UAAb;AACA,gBAAIC,aAAa,EAAjB;AACA;AACAJ,sBAAU,KAAKR,WAAL,CAAiBa,eAAjB,CAAiCL,OAAjC,CAAV;AACA,gBAAKA,YAAYM,SAAb,IAA4BN,YAAY,EAA5C,EAAiD;AAC/C,sBAAQ,IAAR;AACE,qBAAK,aAAaO,IAAb,CAAkBP,OAAlB,CAAL;AACEG,2BAAS,UAAT;AACAF,iCAAe,IAAf;AACA;AACF,qBAAK,iBAAiBM,IAAjB,CAAsBP,OAAtB,CAAL;AACEG,2BAAS,UAAT;AACAD,qCAAmB,IAAnB;AACA;AACAE,+BAAaJ,QAAQQ,KAAR,CAAc,MAAd,EAAsB,CAAtB,CAAb;AACA;AACF;AACEL,2BAASH,OAAT;AAZJ;AAcA;AACA,kBAAI,CAACG,OAAOM,UAAP,CAAkB,GAAlB,CAAL,EAA6B;AAC3BN,yBAAS,MAAMA,MAAf;AACD;AACF;AACD,gBAAIO,QAAQ,IAAZ;AACA,mBAAO,KAAKnB,UAAL,CAAgBoB,iBAAhB,CAAkC;AACvChB,mBAAK,KAAKA,GAAL,GAAWQ,MADuB;AAEvCS,oBAAMZ,OAFiC;AAGvCa,sBAAQ,KAH+B;AAIvCC,uBAAS;AACP,gCAAgB,kBADT;AAEP,iCAAiB,KAAKjB;AAFf;AAJ8B,aAAlC,EAQJkB,IARI,CAQC,UAASC,QAAT,EAAmB;AACzB;AACA,kBAAIf,YAAJ,EAAkB;AAChB,uBAAOS,MAAMO,uBAAN,CAA8BD,QAA9B,CAAP;AACD;AACD,kBAAId,gBAAJ,EAAsB;AACpB,uBAAOQ,MAAMQ,sBAAN,CAA6BF,QAA7B,EAAuCZ,UAAvC,CAAP;AACD;AACD,qBAAOM,MAAMS,yBAAN,CAAgCH,QAAhC,CAAP;AACD,aAjBM,CAAP;AAkBD;;;kDAEuBA,Q,EAAU;AAChC,gBAAII,kBAAkB,EAAtB;AACA,gBAAIC,UAAU,EAAd;AACA,gBAAIC,eAAe,CACjB,MADiB,EAEjB,QAFiB,EAGjB,SAHiB,EAIjB,eAJiB,EAKjB,WALiB,EAMjB,WANiB,EAOjB,YAPiB,EAQjB,QARiB,EASjB,SATiB,CAAnB;AAWA,iBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIP,SAASJ,IAAT,CAAcY,MAAlC,EAA0CD,GAA1C,EAA+C;AAC7C,kBAAIE,OAAOC,OAAOD,IAAP,CAAYT,SAASJ,IAAT,CAAcW,CAAd,CAAZ,CAAX;AACA,mBAAK,IAAII,IAAI,CAAb,EAAgBA,IAAIF,KAAKD,MAAzB,EAAiCG,GAAjC,EAAsC;AACpC,oBAAIC,UAAUH,KAAKE,CAAL,CAAd;AACA,oBAAIL,aAAaO,OAAb,CAAqBD,OAArB,MAAkC,CAAC,CAAvC,EAA0C;AACxC,sBAAIE,WAAWd,SAASJ,IAAT,CAAcW,CAAd,EAAiBK,OAAjB,CAAf;AACA,sBAAIG,cAAcH,UAAU,GAAV,GAAgBE,QAAlC;AACA,sBAAIT,QAAQQ,OAAR,CAAgBE,WAAhB,IAA+B,CAAnC,EAAsC;AACpCV,4BAAQW,IAAR,CAAaD,WAAb;AACD;AACF;AACF;AACF;AACD,gBAAIV,QAAQG,MAAR,GAAiB,CAArB,EAAwB;AACtB;AACAH,sBAAQY,IAAR;AACA,mBAAK,IAAIV,KAAI,CAAb,EAAgBA,KAAIF,QAAQG,MAA5B,EAAoCD,IAApC,EAAyC;AACvCH,gCAAgBY,IAAhB,CACE;AACEE,wBAAMb,QAAQE,EAAR,CADR;AAEEY,8BAAY;AAFd,iBADF;AAMD;AACF;AACD,mBAAOf,eAAP;AACD;;;iDAEsBJ,Q,EAAUoB,G,EAAK;AACpC,gBAAIC,WAAWD,IAAI5B,KAAJ,CAAU,GAAV,CAAf;AACA,gBAAI8B,aAAaD,SAAS,CAAT,CAAjB;AACA,gBAAIE,kBAAkBF,SAAS,CAAT,CAAtB;AACA,gBAAIjB,kBAAkB,EAAtB;AACA,gBAAIoB,eAAe,EAAnB;AACA,iBAAK,IAAIjB,IAAI,CAAb,EAAgBA,IAAIP,SAASJ,IAAT,CAAcY,MAAlC,EAA0CD,GAA1C,EAA+C;AAC7C,kBAAIE,OAAOC,OAAOD,IAAP,CAAYT,SAASJ,IAAT,CAAcW,CAAd,CAAZ,CAAX;AACA,mBAAK,IAAII,IAAI,CAAb,EAAgBA,IAAIF,KAAKD,MAAzB,EAAiCG,GAAjC,EAAsC;AACpC,oBAAIC,UAAUH,KAAKE,CAAL,CAAd;AACA,oBAAIW,eAAeV,OAAnB,EAA4B;;AAE1B;AACA,sBAAI,OAAOZ,SAASJ,IAAT,CAAcW,CAAd,EAAiBe,UAAjB,CAAP,KAAwC,QAA5C,EAAsD;AACpD,yBAAK,IAAIG,IAAI,CAAb,EAAgBA,IAAIzB,SAASJ,IAAT,CAAcW,CAAd,EAAiBe,UAAjB,EAA6Bd,MAAjD,EAAyDiB,GAAzD,EAA8D;AAC5D,0BAAIzB,SAASJ,IAAT,CAAcW,CAAd,EAAiBe,UAAjB,EAA6BG,CAA7B,MAAoCF,eAAxC,EAAyD;AACvD;AACA,4BAAIT,WAAWd,SAASJ,IAAT,CAAcW,CAAd,EAAiB3B,IAAhC;AACA,4BAAI4C,aAAaX,OAAb,CAAqBC,QAArB,IAAiC,CAArC,EAAwC;AACtCU,uCAAaR,IAAb,CAAkBF,QAAlB;AACD;AACF;AACF;AACF,mBAVD,MAUO;AACL,wBAAId,SAASJ,IAAT,CAAcW,CAAd,EAAiBe,UAAjB,MAAiCC,eAArC,EAAsD;AACpD;AACA,0BAAIT,YAAWd,SAASJ,IAAT,CAAcW,CAAd,EAAiB3B,IAAhC;AACA,0BAAI4C,aAAaX,OAAb,CAAqBC,SAArB,IAAiC,CAArC,EAAwC;AACtCU,qCAAaR,IAAb,CAAkBF,SAAlB;AACD;AACF;AACF;AACF;AACF;AACF;AACD,gBAAIU,aAAahB,MAAb,GAAsB,CAA1B,EAA6B;AAC3B;AACA,mBAAK,IAAID,MAAI,CAAb,EAAgBA,MAAIiB,aAAahB,MAAjC,EAAyCD,KAAzC,EAA8C;AAC5CH,gCAAgBY,IAAhB,CACE;AACEE,wBAAMM,aAAajB,GAAb;AADR,iBADF;AAKD;AACF;AACD,mBAAOH,eAAP;AACD;;;oDAOyBsB,M,EAAQ;AAChC,mBAAO9E,EAAE+E,GAAF,CAAMD,OAAO9B,IAAb,EAAmB,UAASgC,CAAT,EAAY;AACpC,kBAAIC,IAAI;AACNX,sBAAM,EADA;AAENC,4BAAY;AAFN,eAAR;AAIA,kBAAI;AACFU,oBAAI;AACFX,wBAAMU,EAAEhD,IADN;AAEFuC,8BAAY;AAFV,iBAAJ;AAID,eALD,CAKE,OAAOW,CAAP,EAAU;AAAEC,wBAAQC,GAAR,CAAY,UAAZ;AAAyB;AACvC,qBAAOH,CAAP;AACD,aAZM,CAAP;AAaD;;;yCAOcI,U,EAAY;AACzB,gBAAIC,SAAS,EAAb;AACA,iBAAK,IAAI3B,IAAI,CAAb,EAAgBA,IAAI0B,WAAWzB,MAA/B,EAAuCD,GAAvC,EAA4C;AAC1C,kBAAI0B,WAAW1B,CAAX,EAAc4B,aAAd,KAAgC,YAApC,EAAkD;AAChD,oBAAIC,aAAaH,WAAW1B,CAAX,EAAc8B,KAA/B;AACA,oBAAI,KAAK7D,WAAL,CAAiB8D,eAAjB,CAAiCF,UAAjC,CAAJ,EAAkD;AAChD;AACA,sBAAIG,cAAc,KAAK/D,WAAL,CAAiBgE,OAAjB,CAAyBJ,UAAzB,CAAlB;AACA,sBAAIG,YAAY/B,MAAZ,GAAqB,CAAzB,EAA4B;AAC1B;AACA;AACA,wBAAI+B,YAAY9C,UAAZ,CAAuB,GAAvB,CAAJ,EAAiC;AAC/B8C,oCAAcA,YAAYE,KAAZ,CAAkB,CAAlB,EAAqB,CAAC,CAAtB,CAAd;AACA,0BAAIC,eAAeH,YAAY/C,KAAZ,CAAkB,GAAlB,CAAnB;AACA0C,6BAAOlB,IAAP,CAAY2B,KAAZ,CAAkBT,MAAlB,EAA0BQ,YAA1B;AACD,qBAJD,MAIO;AACLR,6BAAOlB,IAAP,CAAYuB,WAAZ;AACD;AACF;AACF,iBAdD,MAcO;AACLL,yBAAOlB,IAAP,CAAYoB,UAAZ;AACD;AACF;AACF;AACD;AACA,mBAAOF,MAAP;AACD;;;wCAOaD,U,EAAY;AACxB,gBAAIC,SAAS,EAAb;AACA,iBAAK,IAAI3B,IAAI,CAAb,EAAgBA,IAAI0B,WAAWzB,MAA/B,EAAuCD,GAAvC,EAA4C;AAC1C,kBAAI0B,WAAW1B,CAAX,EAAc4B,aAAd,KAAgC,WAApC,EAAiD;AAC/C,oBAAIC,aAAaH,WAAW1B,CAAX,EAAc8B,KAA/B;AACA,oBAAI,KAAK7D,WAAL,CAAiB8D,eAAjB,CAAiCF,UAAjC,CAAJ,EAAkD;AAChD;AACA,sBAAIG,cAAc,KAAK/D,WAAL,CAAiBgE,OAAjB,CAAyBJ,UAAzB,CAAlB;AACA,sBAAIG,YAAY/B,MAAZ,GAAqB,CAAzB,EAA4B;AAC1B;AACA;AACA,wBAAI+B,YAAY9C,UAAZ,CAAuB,GAAvB,CAAJ,EAAiC;AAC/B8C,oCAAcA,YAAYE,KAAZ,CAAkB,CAAlB,EAAqB,CAAC,CAAtB,CAAd;AACA,0BAAIC,eAAeH,YAAY/C,KAAZ,CAAkB,GAAlB,CAAnB;AACA0C,6BAAOlB,IAAP,CAAY2B,KAAZ,CAAkBT,MAAlB,EAA0BQ,YAA1B;AACD,qBAJD,MAIO;AACLR,6BAAOlB,IAAP,CAAYuB,WAAZ;AACD;AACF;AACF,iBAdD,MAcO;AACLL,yBAAOlB,IAAP,CAAYoB,UAAZ;AACD;AACF;AACF;AACD,mBAAOF,MAAP;AACD;;;4CAOiBD,U,EAAY;AAC5B,gBAAIC,SAAS,EAAb;AACA,iBAAK,IAAI3B,IAAI,CAAb,EAAgBA,IAAI0B,WAAWzB,MAA/B,EAAuCD,GAAvC,EAA4C;AAC1C,kBAAI0B,WAAW1B,CAAX,EAAc4B,aAAd,KAAgC,eAApC,EAAqD;AACnD,oBAAIC,aAAaH,WAAW1B,CAAX,EAAc8B,KAA/B;AACA,oBAAI,KAAK7D,WAAL,CAAiB8D,eAAjB,CAAiCF,UAAjC,CAAJ,EAAkD;AAChD;AACA,sBAAIG,cAAc,KAAK/D,WAAL,CAAiBgE,OAAjB,CAAyBJ,UAAzB,CAAlB;AACA,sBAAIG,YAAY/B,MAAZ,GAAqB,CAAzB,EAA4B;AAC1B;AACA;AACA,wBAAI+B,YAAY9C,UAAZ,CAAuB,GAAvB,CAAJ,EAAiC;AAC/B8C,oCAAcA,YAAYE,KAAZ,CAAkB,CAAlB,EAAqB,CAAC,CAAtB,CAAd;AACA,0BAAIC,eAAeH,YAAY/C,KAAZ,CAAkB,GAAlB,CAAnB;AACA0C,6BAAOlB,IAAP,CAAY2B,KAAZ,CAAkBT,MAAlB,EAA0BQ,YAA1B;AACD,qBAJD,MAIO;AACLR,6BAAOlB,IAAP,CAAYuB,WAAZ;AACD;AACF;AACF,iBAdD,MAcO;AACLL,yBAAOlB,IAAP,CAAYoB,UAAZ;AACD;AACF;AACF;AACD,mBAAOF,MAAP;AACD;;;8CAEmBU,O,EAAS;AAC3B,iBAAK,IAAIrC,IAAI,CAAb,EAAgBA,IAAIqC,QAAQpC,MAA5B,EAAoCD,GAApC,EAAyC;AACvC,kBAAIsC,UAAUD,QAAQrC,CAAR,CAAd;AACA,sBAAQsC,QAAQC,UAAhB;AACE,qBAAK,OAAL;AACE;AACA;AACA;AACA;AACA;AACA,sBAAIC,aAAaF,QAAQG,eAAzB;AACA,sBAAIC,cAAcJ,QAAQK,gBAA1B;AACA,sBAAIC,iBAAiB,KAAK3E,WAAL,CAAiBgE,OAAjB,CAAyBS,WAAzB,CAArB;AACAJ,0BAAQO,wBAAR,GAAmCD,cAAnC;AACA;AAXJ;AAaD;AACD,mBAAOP,OAAP;AACD;;;4CAOiBS,M,EAAQ;AACxB,gBAAIC,OAAO,EAAX;AACA,gBAAIC,eAAe,SAAnB;AACA,gBAAIC,cAAc,IAAlB;AACA,gBAAIC,aAAa,IAAjB;AACA,gBAAIC,iBAAiB,IAArB;AACA,gBAAIL,OAAOpB,UAAP,KAAsB3C,SAA1B,EAAqC;AACnCkE,4BAAc,KAAKG,cAAL,CAAoBN,OAAOpB,UAA3B,CAAd;AACAwB,2BAAa,KAAKG,aAAL,CAAmBP,OAAOpB,UAA1B,CAAb;AACAyB,+BAAiB,KAAKG,iBAAL,CAAuBR,OAAOpB,UAA9B,CAAjB;AACD;AACD,gBAAIoB,OAAOT,OAAP,KAAmBtD,SAAvB,EAAkC;AAChC;AACA,mBAAKwE,mBAAL,CAAyBT,OAAOT,OAAhC;AACA;AACA;AACD;AACD,gBAAIS,OAAOU,KAAP,KAAiBzE,SAArB,EAAgC;AAC9B+D,qBAAOW,aAAP,GAAuB,KAAKxF,WAAL,CAAiBgE,OAAjB,CAAyBa,OAAOU,KAAhC,CAAvB;AACD;;AAED,oBAAQV,OAAOY,UAAf;AACE,mBAAK,YAAL;AACA,mBAAK,iBAAL;AACE;AACAX,uBAAO7F,iBAAiB4F,MAAjB,EAAyBK,cAAzB,CAAP;AACA;AACF,mBAAK,qBAAL;AACE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACF,mBAAK,oBAAL;AACEJ,uBAAOrF,oBAAoBuF,WAApB,CAAP;AACA;AACF,mBAAK,SAAL;AACA,mBAAK,cAAL;AACE;AACAF,uBAAOnG,eAAesG,UAAf,EAA2BD,WAA3B,CAAP;AACA;AACF,mBAAK,eAAL;AACE;AACA;AACAF,uBAAOtF,qBAAqBwF,WAArB,CAAP;AACA;AACF,mBAAK,eAAL;AACA,mBAAK,oBAAL;AACA,mBAAK,QAAL;AACA,mBAAK,aAAL;AACE;AACAF,uBAAO9F,cAAciG,UAAd,EAA0BD,WAA1B,CAAP;AACA;AACF,mBAAK,cAAL;AACA,mBAAK,eAAL;AACE;AACAF,uBAAO1F,cAAc6F,UAAd,EAA0BD,WAA1B,CAAP;AACA;AACF,mBAAK,mBAAL;AACE;AACA;AACF,mBAAK,uBAAL;AACE;AACA;AACF,mBAAK,cAAL;AACE;AACA;AAlDJ;AAoDA,mBAAOF,IAAP;AACD;;;qCAEUY,S,EAAW;AACpB,gBAAIC,UAAU,EAAd;AACA,iBAAK,IAAI5D,IAAI,CAAb,EAAgBA,IAAI2D,UAAUtE,IAAV,CAAeY,MAAnC,EAA2CD,GAA3C,EAAgD;AAC9C,kBAAI6D,QAAQF,UAAUtE,IAAV,CAAeW,CAAf,EAAkB8C,MAAlB,CAAyBe,KAArC;AACA,kBAAID,QAAQE,cAAR,CAAuBD,KAAvB,CAAJ,EAAmC;AACjCD,wBAAQC,KAAR,EAAepD,IAAf,CAAoBkD,UAAUtE,IAAV,CAAeW,CAAf,CAApB;AACD,eAFD,MAEO;AACL4D,wBAAQC,KAAR,IAAiB,CAACF,UAAUtE,IAAV,CAAeW,CAAf,CAAD,CAAjB;AACD;AACF;AACD;AACA;AACA,mBAAO4D,OAAP;AACD;;;6CAEkBF,U,EAAYK,O,EAASJ,S,EAAW;AACjD,gBAAIxC,SAAS,EAAb;AACA,oBAAQuC,UAAR;AACE,mBAAK,YAAL;AACEvC,yBAAShE,8BAA8B4G,OAA9B,EAAuCJ,SAAvC,CAAT;AACA;AACF,mBAAK,iBAAL;AACExC,yBAAS/D,wBAAwB2G,OAAxB,EAAiCJ,SAAjC,CAAT;AACA,uBAAOxC,MAAP;AACF,mBAAK,SAAL;AACEA,yBAASzE,2BAA2BqH,OAA3B,EAAoCJ,SAApC,CAAT;AACA,uBAAOxC,MAAP;AACF,mBAAK,cAAL;AACEA,yBAAS3E,qBAAqBuH,OAArB,EAA8BJ,SAA9B,CAAT;AACA,uBAAOxC,MAAP;AACF,mBAAK,oBAAL;AACEA,yBAASxD,0BAA0BoG,OAA1B,EAAmCJ,SAAnC,CAAT;AACA,uBAAOxC,MAAP;AACF,mBAAK,eAAL;AACEA,yBAAS1E,iCAAiCsH,OAAjC,EAA0CJ,SAA1C,CAAT;AACA;AACF,mBAAK,QAAL;AACExC,yBAASrE,0BAA0BiH,OAA1B,EAAmCJ,SAAnC,CAAT;AACA;AACF,mBAAK,aAAL;AACExC,yBAAStE,oBAAoBkH,OAApB,EAA6BJ,SAA7B,CAAT;AACA;AACF,mBAAK,eAAL;AACExC,yBAASpE,4BAA4BgH,OAA5B,EAAqCJ,SAArC,CAAT;AACA;AACF,mBAAK,oBAAL;AACExC,yBAASnE,gCAAgC+G,OAAhC,EAAyCJ,SAAzC,CAAT;AACA;AACF,mBAAK,cAAL;AACExC,yBAAS3D,qBAAqBuG,OAArB,EAA8BJ,SAA9B,CAAT;AACA;AACF,mBAAK,eAAL;AACExC,yBAAS7D,sBAAsByG,OAAtB,EAA+BJ,SAA/B,CAAT;AACA;AACF;AACEnC,wBAAQC,GAAR,CAAY,qBAAZ;AACA;AAvCJ;AAyCA,mBAAON,MAAP;AACD;;;wCAEa4C,O,EAAS5C,M,EAAQ;AAC7B;AACA,iBAAK,IAAInB,IAAI,CAAb,EAAgBA,IAAImB,OAAO9B,IAAP,CAAYY,MAAhC,EAAwCD,GAAxC,EAA6C;AAC3CmB,qBAAO9B,IAAP,CAAYW,CAAZ,EAAegE,SAAf,GAA2B7C,OAAO9B,IAAP,CAAYW,CAAZ,EAAe8C,MAA1C;AACD;AACD,mBAAO3B,MAAP;AACD;;;yCAEc4C,O,EAAS5C,M,EAAQ;AAC9B;AACA,gBAAK4C,QAAQ1B,OAAR,KAAoBtD,SAArB,IAAoCgF,QAAQ1B,OAAR,CAAgBpC,MAAhB,GAAyB,CAAjE,EAAqE;AACnE,kBAAIgE,aAAa,EAAjB;AACA,mBAAK,IAAIjE,IAAI,CAAb,EAAgBA,IAAI+D,QAAQ1B,OAAR,CAAgBpC,MAApC,EAA4CD,GAA5C,EAAiD;AAC/C,oBAAIsC,UAAUyB,QAAQ1B,OAAR,CAAgBrC,CAAhB,CAAd;AACA;AACA,qBAAK,IAAII,IAAI,CAAb,EAAgBA,IAAIe,OAAO9B,IAAP,CAAYY,MAAhC,EAAwCG,GAAxC,EAA6C;AAC3C,sBAAI8D,aAAa/C,OAAO9B,IAAP,CAAYe,CAAZ,EAAe4D,SAAhC;AACA,sBAAI1B,QAAQC,UAAR,KAAuB2B,UAA3B,EAAuC;AACrC;AACA,wBAAIH,QAAQN,aAAZ,EAA2B;AACzBtC,6BAAO9B,IAAP,CAAYe,CAAZ,EAAe0C,MAAf,GAAwBiB,QAAQN,aAAR,GAAwB,GAAxB,GAA8BS,UAAtD;AACD;AACD;AACAD,+BAAWxD,IAAX,CAAgBU,OAAO9B,IAAP,CAAYe,CAAZ,CAAhB;AACD;AACF;AACF;AACD;AACA,kBAAI6D,WAAWhE,MAAX,GAAoB,CAAxB,EAA2B;AACzBkB,uBAAO9B,IAAP,GAAc4E,UAAd;AACD;AACF,aArBD,MAqBO;AACL;AACA,kBAAIF,QAAQN,aAAZ,EAA2B;AACzB,qBAAK,IAAIzD,MAAI,CAAb,EAAgBA,MAAImB,OAAO9B,IAAP,CAAYY,MAAhC,EAAwCD,KAAxC,EAA6C;AAC3CmB,yBAAO9B,IAAP,CAAYW,GAAZ,EAAe8C,MAAf,GAAwBiB,QAAQN,aAAhC;AACD;AACF;AACF;;AAED,mBAAOtC,MAAP;AACD;;;2CAOgBwC,S,EAAW;;AAE1B;AACA;AACA;AACA,gBAAIQ,aAAa,EAAE9E,MAAM,EAAR,EAAjB;AACA,gBAAI,CAACsE,SAAD,IAAc,CAACA,UAAUtE,IAA7B,EAAmC;AACjC,qBAAO8E,UAAP;AACD;AACD,gBAAIP,UAAU,KAAKQ,UAAL,CAAgBT,SAAhB,CAAd;;AAEA;AACA,gBAAIU,aAAalE,OAAOD,IAAP,CAAY0D,OAAZ,CAAjB;AACA,iBAAK,IAAI5D,IAAI,CAAb,EAAgBA,IAAIqE,WAAWpE,MAA/B,EAAuCD,GAAvC,EAA4C;AAC1C,kBAAIsE,OAAOD,WAAWrE,CAAX,CAAX;AACA,kBAAI0D,aAAaE,QAAQU,IAAR,EAAc,CAAd,EAAiBxB,MAAjB,CAAwBY,UAAzC;AACA;AACA,kBAAIK,UAAUH,QAAQU,IAAR,EAAc,CAAd,EAAiBxB,MAA/B;AACA;AACA;AACA,kBAAI3B,SAAS,KAAKoD,kBAAL,CAAwBb,UAAxB,EAAoCK,OAApC,EAA6CJ,SAA7C,CAAb;AACA;AACAxC,uBAAS,KAAKqD,aAAL,CAAmBT,OAAnB,EAA4B5C,MAA5B,CAAT;AACA;AACAA,uBAAS,KAAKsD,cAAL,CAAoBV,OAApB,EAA6B5C,MAA7B,CAAT;AACA;AACA,mBAAK,IAAInB,MAAI,CAAb,EAAgBA,MAAImB,OAAO9B,IAAP,CAAYY,MAAhC,EAAwCD,KAAxC,EAA6C;AAC3CmE,2BAAW9E,IAAX,CAAgBoB,IAAhB,CAAqBU,OAAO9B,IAAP,CAAYW,GAAZ,CAArB;AACD;AACF;AACD,mBAAOmE,UAAP;AACD;;;2CAKgBO,M,EAAQC,S,EAAW,CAmBnC;AAlBC;AACA;;;;;;;;;;;;;;;;;;;AAmBF;;;;;;;;;8CAMoB7B,M,EAAQ8B,S,EAAW;AACrC,gBAAI5B,eAAe,UAAnB;;AAEA,oBAAQ4B,UAAUhD,aAAlB;AACE,mBAAK,YAAL;AACEoB,+BAAe,UAAf;AACA;AACF,mBAAK,WAAL;AACEA,+BAAe,SAAf;AACA;AACF,mBAAK,eAAL;AACEA,+BAAe,aAAf;AACA;AATJ;AAWA,mBAAO,KAAKhF,UAAL,CAAgBoB,iBAAhB,CAAkC;AACvChB,mBAAK,KAAKA,GAAL,GAAW4E,YADuB;AAEvC1D,sBAAQ,KAF+B;AAGvCC,uBAAS;AACP,gCAAgB,kBADT;AAEP,iCAAiB,KAAKjB;AAFf;AAH8B,aAAlC,EAOJkB,IAPI,CAOC,KAAKqF,cAPN,CAAP;AAQD;;;yCAEc1D,M,EAAQ;AACrB,mBAAO9E,EAAE+E,GAAF,CAAMD,OAAO9B,IAAb,EAAmB,UAACgC,CAAD,EAAIrB,CAAJ,EAAU;AAClC,qBAAO;AACLW,sBAAMU,EAAEhD,IADH;AAELyD,uBAAOT,EAAEhD;AAFJ,eAAP;AAID,aALM,CAAP;AAMD;;;2CAQgByE,M,EAAQgC,M,EAAQ;AAC/B,gBAAIC,YAAY,UAAhB;AACA,oBAAQD,OAAOvC,UAAf;AACE,mBAAK,YAAL;AACEwC,4BAAY,UAAZ;AACA;AACF,mBAAK,WAAL;AACEA,4BAAY,SAAZ;AACA;AACF,mBAAK,eAAL;AACEA,4BAAY,aAAZ;AACA;AATJ;AAWA,mBAAO,KAAK/G,UAAL,CAAgBoB,iBAAhB,CAAkC;AACvChB,mBAAK,KAAKA,GAAL,GAAW2G,SADuB;AAEvCzF,sBAAQ,KAF+B;AAGvCC,uBAAS;AACP,gCAAgB,kBADT;AAEP,iCAAiB,KAAKjB;AAFf;AAH8B,aAAlC,EAOJkB,IAPI,CAOC,KAAKqF,cAPN,CAAP;AAQD;;;gCAEKpG,O,EAAS;AACb;AACA,gBAAIuG,UAAU,EAAd;AACA,gBAAI7F,QAAQ,IAAZ;AACA,gBAAI8F,eAAe,IAAnB;AACAxG,oBAAQyG,OAAR,CAAgBC,OAAhB,CAAwB,UAASrC,MAAT,EAAiB;AACvC;AACA;AACA;AACA;AACAkC,sBAAQvE,IAAR,CAAaqC,MAAb;AACD,aAND;AAOA,gBAAIsC,WAAW3G,QAAQ2G,QAAvB;AACA;AACA,gBAAI7I,IAAI8I,cAAJ,CAAmBD,QAAnB,IAA+B,KAAKE,eAAxC,EAAyD;AACvD;AACAF,yBAAW7I,IAAIgJ,YAAJ,CAAiB,KAAKD,eAAL,GAAuB,IAAxC,CAAX;AACA;AACD;AACD;AACA,gBAAIE,WAAW,KAAKhH,CAAL,CAAOiH,KAAP,EAAf;;AAEA;AACA,gBAAIT,QAAQ/E,MAAR,KAAmB,CAAvB,EAA0B;AACxB;AACAuF,uBAASE,OAAT,CAAiB;AACfrG,sBAAM;AADS,eAAjB;AAGA,qBAAOmG,SAASG,OAAhB;AACD;AACD,gBAAIC,aAAa,KAAKpH,CAAL,CAAOqH,GAAP,CAAW;AAC1BC,qBAAO3G,MAAM4G,mBAAN,CAA0Bf,OAA1B;AADmB,aAAX,CAAjB;AAGAY,uBAAWpG,IAAX,CAAgB,UAASwG,OAAT,EAAkB;AAChC;AACAR,uBAASE,OAAT,CAAiBM,QAAQF,KAAzB;AACD,aAHD;AAIA,mBAAON,SAASG,OAAhB;AACD;;;0CAEeV,Y,EAAcgB,O,EAAS;AACrC;AACA,gBAAI9G,QAAQ,IAAZ;AACA,gBAAIqG,WAAW,KAAKhH,CAAL,CAAOiH,KAAP,EAAf;AACA,gBAAIS,SAAS,EAAb;AACA,gBAAIC,cAAc;AAChB7G,sBAAQ,KADQ;AAEhBlB,mBAAK,KAAKA,GAAL,GAAW6H,OAFA;AAGhBC,sBAAQA,MAHQ;AAIhB3G,uBAAS;AACP,gCAAgB,kBADT;AAEP,iCAAiB,KAAKjB;AAFf;AAJO,aAAlB;AASA,iBAAKN,UAAL,CAAgBoB,iBAAhB,CAAkC+G,WAAlC,EACG3G,IADH,CACQ,UAASC,QAAT,EAAmB;AACvB,kBAAI2G,UAAU,IAAd;AACA,kBAAI3G,SAAS4G,MAAT,KAAoB,GAAxB,EAA6B;AAC3B7E,wBAAQC,GAAR,CAAY,UAAZ;AACA2E,0BAAU,IAAIE,KAAJ,CAAU,iBAAiB7G,SAAS4G,MAApC,CAAV;AACAb,yBAASe,MAAT,CAAgBH,OAAhB;AACD;AACD,kBAAI,CAAC3G,SAASJ,IAAd,EAAoB;AAClB+G,0BAAU,IAAIE,KAAJ,CAAU,SAAV,CAAV;AACAd,yBAASe,MAAT,CAAgBH,OAAhB;AACD;AACD;AACA;AACA;AACAZ,uBAASE,OAAT,CAAiB,EAAE5C,QAAQmC,YAAV,EAAwBxF,UAAUA,QAAlC,EAAjB;AACD,aAhBH,EAgBK,UAASA,QAAT,EAAmB;AACpB+B,sBAAQgF,KAAR,CAAc,mCAAd,EAAmD/G,SAASJ,IAAT,GAAgBI,SAASJ,IAAT,CAAcoH,OAA9B,GAAwChH,QAA3F;AACA,kBAAI+G,QAAQ,IAAIF,KAAJ,CAAU,qBAAV,CAAZ;AACAd,uBAASe,MAAT,CAAgBC,KAAhB;AACD,aApBH;;AAsBA,mBAAOhB,SAASG,OAAhB;AACD;;;oCAOShC,S,EAAW;AACnB;AACA;AACA,mBAAO,KAAK+C,gBAAL,CAAsB/C,SAAtB,CAAP;AACD;;;8CAOmBgD,c,EAAgB;AAClC,gBAAInB,WAAW,KAAKhH,CAAL,CAAOiH,KAAP,EAAf;AACA,gBAAImB,YAAY,EAAhB;AACA,gBAAIzH,QAAQ,IAAZ;AACA;AACA;AACA/C,oBAAQ+I,OAAR,CAAgBwB,cAAhB,EAAgC,UAAS5C,OAAT,EAAkB;AAChD,kBAAI8C,UAAU1H,MAAM2H,iBAAN,CAAwB/C,OAAxB,CAAd;AACA,mBAAK,IAAI/D,IAAI,CAAb,EAAgBA,IAAI6G,QAAQ5G,MAA5B,EAAoCD,GAApC,EAAyC;AACvC4G,0BAAUnG,IAAV,CAAetB,MAAM4H,eAAN,CAAsBhD,OAAtB,EAA+B8C,QAAQ7G,CAAR,CAA/B,CAAf;AACD;AACF,aALD;AAMA,iBAAKxB,CAAL,CAAOqH,GAAP,CAAWe,SAAX,EACGpH,IADH,CAEI,UAASwG,OAAT,EAAkB;AAChB,kBAAIvG,WAAW;AACbJ,sBAAM;AADO,eAAf;AAGA;AACAjD,sBAAQ+I,OAAR,CAAgBa,OAAhB,EAAyB,UAAS7E,MAAT,EAAiB;AACxC1B,yBAASJ,IAAT,CAAcoB,IAAd,CAAmBU,MAAnB;AACA;AACA;AACA;AACD,eALD;AAMA;AACAqE,uBAASE,OAAT,CAAiBvG,MAAM6H,SAAN,CAAgBvH,QAAhB,CAAjB;AACD,aAfL,EAgBI,UAASwH,MAAT,EAAiB;AACfzB,uBAASe,MAAT,CAAgBU,MAAhB;AACD,aAlBL,EAmBI,UAASC,OAAT,EAAkB;AAChB1B,uBAAS2B,MAAT,CAAgBD,OAAhB;AACD,aArBL;AAuBA,mBAAO1B,SAASG,OAAhB;AACD;;;2CAWgB;AACf,mBAAO,KAAK3H,UAAL,CAAgBoB,iBAAhB,CAAkC;AACvChB,mBAAK,KAAKA,GAAL,GAAW,OADuB;AAEvCmB,uBAAS;AACP,gCAAgB,kBADT;AAEP,iCAAiB,KAAKjB;AAFf,eAF8B;AAMvCgB,sBAAQ;AAN+B,aAAlC,EAOJE,IAPI,CAOC,oBAAY;AAClB,kBAAIC,SAAS4G,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,uBAAO;AACLA,0BAAQ,SADH;AAELI,2BAAS,wBAFJ;AAGLW,yBAAO;AAHF,iBAAP;AAKD;AACF,aAfM,CAAP;AAgBD","file":"datasource.js","sourcesContent":["import angular from \"angular\";\nimport _ from \"lodash\";\nimport dateMath from \"app/core/utils/datemath\";\nimport kbn from \"app/core/utils/kbn\";\nimport {\n  convertClientsToJSON,\n  convertClientHistoryToDataPoints,\n  convertClientsToDataPoints,\n  convertClientSummaryMetricsToJSON,\n  getClientsURIs\n} from './client_functions';\nimport {\n  convertEventsToJSON,\n  convertEventsToDataPoints,\n  convertEventsToEventMetrics,\n  convertEventsToEventMetricsJSON,\n  getEventsURIs\n} from './event_functions';\nimport {\n  getAggregateURIs,\n  convertAggregatesToDataPoints,\n  convertAggregatesToJSON\n} from './aggregate_functions';\nimport {\n  getResultURIs,\n  convertResultsToTable,\n  convertResultsToDataPoints,\n  convertResultsToJSON\n} from './result_functions';\nimport {\n  getClientHistoryURIs\n} from './clienthistory_functions';\nimport {\n  getClientHealthURIs,\n  convertClientHealthToJSON,\n  convertClientHealthMetricsToJSON\n} from './client_health_functions';\n\nexport class SensuDatasource {\n\n  constructor(instanceSettings, $q, backendSrv, templateSrv, uiSegmentSrv) {\n    this.type = instanceSettings.type;\n    this.url = instanceSettings.url;\n    this.name = instanceSettings.name;\n    this.basicAuth = instanceSettings.basicAuth;\n    this.withCredentials = instanceSettings.withCredentials;\n    this.q = $q;\n    this.backendSrv = backendSrv;\n    this.templateSrv = templateSrv;\n    this.uiSegmentSrv = uiSegmentSrv;\n    //this.clientQueryTags = [];\n  }\n\n  // Required for templating\n  // gets the clients from Sensu API\n  // https://sensuapp.org/docs/0.26/api/clients-api.html\n\n  /**\n   * [metricFindQuery description]\n   * @param  {[type]} options [description]\n   * @return {[type]}         [description]\n   */\n  metricFindQuery(options) {\n    //console.log(\"metricFindQuery entered: \" + options);\n    var isClientTags = false;\n    var isClientTagValue = false;\n    var aQuery = \"/clients\";\n    var tagToValue = \"\";\n    // substitute template vars\n    options = this.templateSrv.replaceWithText(options);\n    if ((options !== undefined) && (options !== \"\")) {\n      switch (true) {\n        case /clienttags/.test(options):\n          aQuery = '/clients';\n          isClientTags = true;\n          break;\n        case /clienttagvalue/.test(options):\n          aQuery = '/clients';\n          isClientTagValue = true;\n          // split out the tag from the query\n          tagToValue = options.split(\"tag=\")[1];\n          break;\n        default:\n          aQuery = options;\n      }\n      // make sure there is a leading slash\n      if (!aQuery.startsWith(\"/\")) {\n        aQuery = \"/\" + aQuery;\n      }\n    }\n    var _this = this;\n    return this.backendSrv.datasourceRequest({\n      url: this.url + aQuery,\n      data: options,\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\": this.basicAuth\n      }\n    }).then(function(response) {\n      //_this.clientQueryTags = _this.generateClientQueryTags(response);\n      if (isClientTags) {\n        return _this.generateClientQueryTags(response);\n      }\n      if (isClientTagValue) {\n        return _this.getClientQueryTagValue(response, tagToValue);\n      }\n      return _this.mapToClientNameAndVersion(response);\n    });\n  }\n\n  generateClientQueryTags(response) {\n    var clientQueryTags = [];\n    var allTags = [];\n    var excludedTags = [\n      'name',\n      'socket',\n      'address',\n      'subscriptions',\n      'timestamp',\n      'keepalive',\n      'keepalives',\n      'redact',\n      'version'\n    ];\n    for (let i = 0; i < response.data.length; i++) {\n      var keys = Object.keys(response.data[i]);\n      for (let j = 0; j < keys.length; j++) {\n        let keyName = keys[j];\n        if (excludedTags.indexOf(keyName) === -1) {\n          let tagValue = response.data[i][keyName];\n          let fullKeyName = keyName + \"=\" + tagValue;\n          if (allTags.indexOf(fullKeyName) < 0) {\n            allTags.push(fullKeyName);\n          }\n        }\n      }\n    }\n    if (allTags.length > 0) {\n      // build the tags\n      allTags.sort();\n      for (let i = 0; i < allTags.length; i++) {\n        clientQueryTags.push(\n          {\n            text: allTags[i],\n            expandable: true\n          }\n        );\n      }\n    }\n    return clientQueryTags;\n  }\n\n  getClientQueryTagValue(response, tag) {\n    var tagSplit = tag.split('=');\n    var tagToMatch = tagSplit[0];\n    var tagValueToMatch = tagSplit[1];\n    var clientQueryTags = [];\n    var allTagValues = [];\n    for (let i = 0; i < response.data.length; i++) {\n      var keys = Object.keys(response.data[i]);\n      for (let j = 0; j < keys.length; j++) {\n        let keyName = keys[j];\n        if (tagToMatch === keyName) {\n\n          // this can be a value or an array inside, check both\n          if (typeof response.data[i][tagToMatch] !== 'string') {\n            for (let z = 0; z < response.data[i][tagToMatch].length; z++) {\n              if (response.data[i][tagToMatch][z] === tagValueToMatch) {\n                //let tagValue = response.data[i][keyName];\n                let tagValue = response.data[i].name;\n                if (allTagValues.indexOf(tagValue) < 0) {\n                  allTagValues.push(tagValue);\n                }\n              }\n            }\n          } else {\n            if (response.data[i][tagToMatch] === tagValueToMatch) {\n              //let tagValue = response.data[i][keyName];\n              let tagValue = response.data[i].name;\n              if (allTagValues.indexOf(tagValue) < 0) {\n                allTagValues.push(tagValue);\n              }\n            }\n          }\n        }\n      }\n    }\n    if (allTagValues.length > 0) {\n      // build the tags\n      for (let i = 0; i < allTagValues.length; i++) {\n        clientQueryTags.push(\n          {\n            text: allTagValues[i]\n          }\n        );\n      }\n    }\n    return clientQueryTags;\n  }\n\n  /**\n   * [mapToClientNameAndVersion description]\n   * @param  {[type]} result [description]\n   * @return {[type]}        [description]\n   */\n  mapToClientNameAndVersion(result) {\n    return _.map(result.data, function(d) {\n      var x = {\n        text: \"\",\n        expandable: true\n      };\n      try {\n        x = {\n          text: d.name,\n          expandable: true\n        };\n      } catch (e) { console.log(\"bad data\");}\n      return x;\n    });\n  }\n\n  /**\n   * [getClientNames description]\n   * @param  {[type]} dimensions [description]\n   * @return {[type]}            [description]\n   */\n  getClientNames(dimensions) {\n    var values = [];\n    for (var i = 0; i < dimensions.length; i++) {\n      if (dimensions[i].dimensionType === 'clientName') {\n        var aDimension = dimensions[i].value;\n        if (this.templateSrv.getVariableName(aDimension)) {\n          // template variable found, expand it\n          var templateVar = this.templateSrv.replace(aDimension);\n          if (templateVar.length > 0) {\n            // the expanded variable comes back as { value1 , value2 }\n            // or it comes back as just a value\n            if (templateVar.startsWith('{')) {\n              templateVar = templateVar.slice(1, -1);\n              var templateVars = templateVar.split(',');\n              values.push.apply(values, templateVars);\n            } else {\n              values.push(templateVar);\n            }\n          }\n        } else {\n          values.push(aDimension);\n        }\n      }\n    }\n    //console.log(values);\n    return values;\n  }\n\n  /**\n   * [getCheckNames description]\n   * @param  {[type]} dimensions [description]\n   * @return {[type]}            [description]\n   */\n  getCheckNames(dimensions) {\n    var values = [];\n    for (var i = 0; i < dimensions.length; i++) {\n      if (dimensions[i].dimensionType === 'checkName') {\n        var aDimension = dimensions[i].value;\n        if (this.templateSrv.getVariableName(aDimension)) {\n          // template variable found, expand it\n          var templateVar = this.templateSrv.replace(aDimension);\n          if (templateVar.length > 0) {\n            // the expanded variable comes back as { value1 , value2 }\n            // or it comes back as just a value\n            if (templateVar.startsWith('{')) {\n              templateVar = templateVar.slice(1, -1);\n              var templateVars = templateVar.split(',');\n              values.push.apply(values, templateVars);\n            } else {\n              values.push(templateVar);\n            }\n          }\n        } else {\n          values.push(aDimension);\n        }\n      }\n    }\n    return values;\n  }\n\n  /**\n   * [getAggregateNames description]\n   * @param  {[type]} dimensions [description]\n   * @return {[type]}            [description]\n   */\n  getAggregateNames(dimensions) {\n    var values = [];\n    for (var i = 0; i < dimensions.length; i++) {\n      if (dimensions[i].dimensionType === 'aggregateName') {\n        var aDimension = dimensions[i].value;\n        if (this.templateSrv.getVariableName(aDimension)) {\n          // template variable found, expand it\n          var templateVar = this.templateSrv.replace(aDimension);\n          if (templateVar.length > 0) {\n            // the expanded variable comes back as { value1 , value2 }\n            // or it comes back as just a value\n            if (templateVar.startsWith('{')) {\n              templateVar = templateVar.slice(1, -1);\n              var templateVars = templateVar.split(',');\n              values.push.apply(values, templateVars);\n            } else {\n              values.push(templateVar);\n            }\n          }\n        } else {\n          values.push(aDimension);\n        }\n      }\n    }\n    return values;\n  }\n\n  replaceFilterValues(filters) {\n    for (var i = 0; i < filters.length; i++) {\n      var aFilter = filters[i];\n      switch (aFilter.filterType) {\n        case 'field':\n          /*jshint -W087 */\n          //debugger;\n          // Field filters have these properties\n          // filterFieldName\n          // filterFieldValue\n          var aFieldName = aFilter.filterFieldName;\n          var aFieldValue = aFilter.filterFieldValue;\n          var templatedValue = this.templateSrv.replace(aFieldValue);\n          aFilter.filterFieldValueReplaced = templatedValue;\n          break;\n      }\n    }\n    return filters;\n  }\n\n  /**\n   * [getQueryURIByType description]\n   * @param  {[type]} target [description]\n   * @return {[type]}        [Array of URIs]\n   */\n  getQueryURIByType(target) {\n    var URIs = [];\n    var dimensionURI = '/events';\n    var clientNames = null;\n    var checkNames = null;\n    var aggregateNames = null;\n    if (target.dimensions !== undefined) {\n      clientNames = this.getClientNames(target.dimensions);\n      checkNames = this.getCheckNames(target.dimensions);\n      aggregateNames = this.getAggregateNames(target.dimensions);\n    }\n    if (target.filters !== undefined) {\n      // convert all templated values\n      this.replaceFilterValues(target.filters);\n      /*jshint -W087 */\n      //debugger;\n    }\n    if (target.alias !== undefined) {\n      target.aliasReplaced = this.templateSrv.replace(target.alias);\n    }\n\n    switch (target.sourceType) {\n      case 'aggregates':\n      case 'aggregates_json':\n        // https://sensuapp.org/docs/0.28/api/aggregates-api.html\n        URIs = getAggregateURIs(target, aggregateNames);\n        break;\n      case 'check_subscriptions':\n        // https://sensuapp.org/docs/0.28/api/checks-api.html\n        //\n        // Returns list of subscription names, with the corresponding checks for the subscription\n        // Dimensions are:\n        //    name - name of check\n        //    aggregate - name of aggregate\n        //    type (metric|check)\n        //    source - JIT client\n        //\n        break;\n      case 'client_health_json':\n        URIs = getClientHealthURIs(clientNames);\n        break;\n      case 'clients':\n      case 'clients_json':\n        // https://sensuapp.org/docs/0.28/api/clients-api.html\n        URIs = getClientsURIs(checkNames, clientNames);\n        break;\n      case 'clienthistory':\n        // https://sensuapp.org/docs/0.28/api/clients-api.html\n        // look for clientName in dimensions\n        URIs = getClientHistoryURIs(clientNames);\n        break;\n      case 'event_metrics':\n      case 'event_metrics_json':\n      case 'events':\n      case 'events_json':\n        // https://sensuapp.org/docs/0.28/api/events-api.html\n        URIs = getEventsURIs(checkNames, clientNames);\n        break;\n      case 'results_json':\n      case 'results_table':\n        // https://sensuapp.org/docs/0.28/api/results-api.html\n        URIs = getResultURIs(checkNames, clientNames);\n        break;\n      case 'sensu_health_json':\n        // https://sensuapp.org/docs/0.28/api/health-and-info-api.html\n        break;\n      case 'silenced_entries_json':\n        // https://sensuapp.org/docs/0.28/api/silenced-api.html\n        break;\n      case 'stashes_json':\n        // https://sensuapp.org/docs/0.28/api/stashes-api.html\n        break;\n    }\n    return URIs;\n  }\n\n  getBuckets(responses) {\n    var buckets = {};\n    for (var i = 0; i < responses.data.length; i++) {\n      var refId = responses.data[i].target.refId;\n      if (buckets.hasOwnProperty(refId)) {\n        buckets[refId].push(responses.data[i]);\n      } else {\n        buckets[refId] = [responses.data[i]];\n      }\n    }\n    /*jshint -W087 */\n    //debugger;\n    return buckets;\n  }\n\n  processConversions(sourceType, aTarget, responses) {\n    var result = [];\n    switch (sourceType) {\n      case 'aggregates':\n        result = convertAggregatesToDataPoints(aTarget, responses);\n        break;\n      case 'aggregates_json':\n        result = convertAggregatesToJSON(aTarget, responses);\n        return result;\n      case 'clients':\n        result = convertClientsToDataPoints(aTarget, responses);\n        return result;\n      case 'clients_json':\n        result = convertClientsToJSON(aTarget, responses);\n        return result;\n      case 'client_health_json':\n        result = convertClientHealthToJSON(aTarget, responses);\n        return result;\n      case 'clienthistory':\n        result = convertClientHistoryToDataPoints(aTarget, responses);\n        break;\n      case 'events':\n        result = convertEventsToDataPoints(aTarget, responses);\n        break;\n      case 'events_json':\n        result = convertEventsToJSON(aTarget, responses);\n        break;\n      case 'event_metrics':\n        result = convertEventsToEventMetrics(aTarget, responses);\n        break;\n      case 'event_metrics_json':\n        result = convertEventsToEventMetricsJSON(aTarget, responses);\n        break;\n      case 'results_json':\n        result = convertResultsToJSON(aTarget, responses);\n        break;\n      case 'results_table':\n        result = convertResultsToTable(aTarget, responses);\n        break;\n      default:\n        console.log(\"Unknown source type\");\n        break;\n    }\n    return result;\n  }\n\n  setRawTargets(aTarget, result) {\n    // keep the actual name\n    for (let i = 0; i < result.data.length; i++) {\n      result.data[i].rawTarget = result.data[i].target;\n    }\n    return result;\n  }\n\n  processFilters(aTarget, result) {\n    // if there are no filters, return all data[] items\n    if ((aTarget.filters !== undefined) && (aTarget.filters.length > 0)) {\n      var filterData = [];\n      for (let i = 0; i < aTarget.filters.length; i++) {\n        var aFilter = aTarget.filters[i];\n        // iterate over the data, find matching targets\n        for (let j = 0; j < result.data.length; j++) {\n          var aRawTarget = result.data[j].rawTarget;\n          if (aFilter.filterType === aRawTarget) {\n            // Prepend Alias\n            if (aTarget.aliasReplaced) {\n              result.data[j].target = aTarget.aliasReplaced + \" \" + aRawTarget;\n            }\n            // save this result\n            filterData.push(result.data[j]);\n          }\n        }\n      }\n      // if we have filtered data, replace the result with it\n      if (filterData.length > 0) {\n        result.data = filterData;\n      }\n    } else {\n      // if there are no filters, apply the alias (this is probably not what you want, but allow it...)\n      if (aTarget.aliasReplaced) {\n        for (let i = 0; i < result.data.length; i++) {\n          result.data[i].target = aTarget.aliasReplaced;\n        }\n      }\n    }\n\n    return result;\n  }\n  /**\n   * [parseQueryResult description]\n   * @param  {[type]} aTarget  [description]\n   * @param  {[type]} responses Array of Responses, containing data[{ target: aTarget, response: response}]\n   * @return {[type]}          [description]\n   */\n  parseQueryResult(responses) {\n\n    // This will match refId's for responses and bucket them together, then pass the bucket to the conversion routines\n    // This allows multiple responses intended for a single target to all be processed at once\n    // It is up to the processor to use the data sent, and return a result that can be used.\n    var allResults = { data: [] };\n    if (!responses || !responses.data) {\n      return allResults;\n    }\n    var buckets = this.getBuckets(responses);\n\n    // iterate over the keys in the buckets to get the target and source type\n    var bucketKeys = Object.keys(buckets);\n    for (let i = 0; i < bucketKeys.length; i++) {\n      let aKey = bucketKeys[i];\n      let sourceType = buckets[aKey][0].target.sourceType;\n      // also use the target from the first response\n      let aTarget = buckets[aKey][0].target;\n      // convert results according to the sourceType\n      // IMPORTANT: do not allow responses to be modifed, return a new object!\n      let result = this.processConversions(sourceType, aTarget, responses);\n      // update result with the rawTarget name (preserve name from aliasing)\n      result = this.setRawTargets(aTarget, result);\n      // apply filters\n      result = this.processFilters(aTarget, result);\n      // iterate over all of the results and push into allResults\n      for (let i = 0; i < result.data.length; i++) {\n        allResults.data.push(result.data[i]);\n      }\n    }\n    return allResults;\n  }\n\n  /**\n   *\n   */\n  getCheckInterval(client, checkName) {\n    // http://10.227.86.62/results/default-oel-67-x86-64/keepalive\n    /* The check may not have interval defined, which means it is defaulted to 60 seconds\n    {\n      \"client\": \"default-oel-67-x86-64\",\n      \"check\": {\n        \"thresholds\": {\n          \"warning\": 120,\n          \"critical\": 180\n        },\n        \"name\": \"keepalive\",\n        \"issued\": 1476277039,\n        \"executed\": 1476277039,\n        \"output\": \"No keepalive sent from client for 40860 seconds (>=180)\",\n        \"status\": 2,\n        \"type\": \"standard\"\n      }\n    }\n     */\n  }\n\n  /**\n   * [dimensionFindValues description]\n   * @param  {[type]} target    [description]\n   * @param  {[type]} dimension [description]\n   * @return {[type]}           [description]\n   */\n  dimensionFindValues(target, dimension) {\n    var dimensionURI = '/clients';\n\n    switch (dimension.dimensionType) {\n      case 'clientName':\n        dimensionURI = '/clients';\n        break;\n      case 'checkName':\n        dimensionURI = '/checks';\n        break;\n      case 'aggregateName':\n        dimensionURI = '/aggregates';\n        break;\n    }\n    return this.backendSrv.datasourceRequest({\n      url: this.url + dimensionURI,\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\": this.basicAuth\n      }\n    }).then(this.mapToTextValue);\n  }\n\n  mapToTextValue(result) {\n    return _.map(result.data, (d, i) => {\n      return {\n        text: d.name,\n        value: d.name\n      };\n    });\n  }\n\n  /**\n   * [dimensionFindValues description]\n   * @param  {[type]} target    [description]\n   * @param  {[type]} filter [description]\n   * @return {[type]}           [description]\n   */\n  filterFindValues(target, filter) {\n    var filterURI = '/clients';\n    switch (filter.filterType) {\n      case 'clientName':\n        filterURI = '/clients';\n        break;\n      case 'checkName':\n        filterURI = '/checks';\n        break;\n      case 'aggregateName':\n        filterURI = '/aggregates';\n        break;\n    }\n    return this.backendSrv.datasourceRequest({\n      url: this.url + filterURI,\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\": this.basicAuth\n      }\n    }).then(this.mapToTextValue);\n  }\n\n  query(options) {\n    //console.log(\"query entered\");\n    var queries = [];\n    var _this = this;\n    var singleTarget = null;\n    options.targets.forEach(function(target) {\n      // TODO handle hide and no target specified\n      //if (target.hide || !target.target) {\n      //  continue;\n      //}\n      queries.push(target);\n    });\n    var interval = options.interval;\n    //console.log(\"options interval = \" + interval);\n    if (kbn.interval_to_ms(interval) < this.minimumInterval) {\n      // console.log(\"Detected interval smaller than allowed: \" + interval);\n      interval = kbn.secondsToHms(this.minimumInterval / 1000);\n      // console.log(\"New Interval: \" + interval);\n    }\n    //console.log(\"interval after min check = \" + interval);\n    var deferred = this.q.defer();\n\n    // if there are no queries, return empty data\n    if (queries.length === 0) {\n      // console.log(\"no tags visible or specified, no data to fetch\");\n      deferred.resolve({\n        data: []\n      });\n      return deferred.promise;\n    }\n    var allQueries = this.q.all({\n      first: _this.multipleDataQueries(queries),\n    });\n    allQueries.then(function(results) {\n      // return results from queries\n      deferred.resolve(results.first);\n    });\n    return deferred.promise;\n  }\n\n  singleDataQuery(singleTarget, uriType) {\n    //console.log(\"singleDataQuery entered\");\n    var _this = this;\n    var deferred = this.q.defer();\n    var params = {};\n    var httpOptions = {\n      method: 'GET',\n      url: this.url + uriType,\n      params: params,\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\": this.basicAuth\n      }\n    };\n    this.backendSrv.datasourceRequest(httpOptions)\n      .then(function(response) {\n        var anError = null;\n        if (response.status !== 200) {\n          console.log(\"error...\");\n          anError = new Error(\"Bad Status: \" + response.status);\n          deferred.reject(anError);\n        }\n        if (!response.data) {\n          anError = new Error(\"No data\");\n          deferred.reject(anError);\n        }\n        // this used to parse per response, instead this is returning the target and response to be later\n        // used by multiDone\n        // OLD: deferred.resolve(_this.parseQueryResult(singleTarget, response));\n        deferred.resolve({ target: singleTarget, response: response});\n      }, function(response) {\n        console.error('Unable to load data. Response: %o', response.data ? response.data.message : response);\n        var error = new Error(\"Unable to load data\");\n        deferred.reject(error);\n      });\n\n    return deferred.promise;\n  }\n\n  /**\n   * Wrapper called when all queries have been completed.\n   * @param  {[type]} responses [description]\n   * @return {[type]}           [description]\n   */\n  multiDone(responses) {\n    /*jshint -W087 */\n    //debugger;\n    return this.parseQueryResult(responses);\n  }\n\n  /**\n   * Leverages promises to perform multiple async queries\n   * @param  {[type]} pendingQueries [description]\n   * @return {[type]}                [description]\n   */\n  multipleDataQueries(pendingQueries) {\n    var deferred = this.q.defer();\n    var dataCalls = [];\n    var _this = this;\n    // for each query, we get a list of sensu uris' to hit\n    // to retrieve the data\n    angular.forEach(pendingQueries, function(aTarget) {\n      var uriList = _this.getQueryURIByType(aTarget);\n      for (var i = 0; i < uriList.length; i++) {\n        dataCalls.push(_this.singleDataQuery(aTarget, uriList[i]));\n      }\n    });\n    this.q.all(dataCalls)\n      .then(\n        function(results) {\n          var response = {\n            data: []\n          };\n          // merge all of the results into one response\n          angular.forEach(results, function(result) {\n            response.data.push(result);\n            //angular.forEach(result.data, function(dataSet) {\n            //  response.data.push(dataSet);\n            //});\n          });\n          // multiDone needs to return all of the parsed results inside somevar.data[]\n          deferred.resolve(_this.multiDone(response));\n        },\n        function(errors) {\n          deferred.reject(errors);\n        },\n        function(updates) {\n          deferred.update(updates);\n        }\n      );\n    return deferred.promise;\n  }\n\n  // Required\n  // Used for testing datasource in datasource configuration pange\n  //    'Access-Control-Allow-Origin': \"http://localhost:3000\"\n  //\n\n  /**\n   * [testDatasource description]\n   * @return {[type]} [description]\n   */\n  testDatasource() {\n    return this.backendSrv.datasourceRequest({\n      url: this.url + '/info',\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\": this.basicAuth\n      },\n      method: 'GET',\n    }).then(response => {\n      if (response.status === 200) {\n        return {\n          status: \"success\",\n          message: \"Data source is working\",\n          title: \"Success\"\n        };\n      }\n    });\n  }\n}\n"]}